language: node_js
node_js:
- 10
branches:
  only:
  - master
git:
  submodules: false

# Use sed to replace the SSH URL with the public URL, then initialize submodules
# https://stackoverflow.com/questions/15674064/how-to-fix-a-permission-denied-publickey-error-for-a-git-submodule-update-in-t
before_install:
- sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
- git submodule update --init --recursive

install:
- npm install

script:
- npm run build

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  keep-history: true
  local-dir: dist/
  on:
    branch: master
  fqdn: mkohler.codes

notifications:
  email:
    on_success: change
    on_failure: always
    recipients:
    - me@michaelkohler.info
